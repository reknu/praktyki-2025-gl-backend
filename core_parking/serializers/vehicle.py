
WYROZNIKI_2_ZNAKOWE = {
    # dolnośląskie
    "DB", "DE", "DL", "DW",
    # kujawsko-pomorskie
    "CB", "CG", "CT", "CW",
    # lubelskie
    "LB", "LC", "LU", "LZ",
    # lubuskie
    "FG", "FZ",
    # łódzkie
    "EL", "EP", "ES",
    # małopolskie
    "KK", "KR", "KN", "KT",
    # mazowieckie
    "WO", "WP", "WR", "WS", "WA", "WB", "WD", "WE", "WF", "WH", "WI", "WJ", "WK", "WN", "WT", "WU", "WW", "WX", "WY",
    # opolskie
    "OP",
    # podkarpackie
    "RK", "RP", "RZ", "RT",
    # podlaskie
    "BI", "BL", "BS",
    # pomorskie
    "GA", "GD", "GS", "GP",
    # śląskie
    "SB", "SY", "SC", "SD", "SE", "SG", "SH", "SI", "SJ", "SK", "SL", "SM", "SN", "SO", "SP", "SR", "ST", "SW", "SZ", "SŻ",
    # świętokrzyskie
    "TK",
    # warmińsko-mazurskie
    "NE", "NO",
    # wielkopolskie
    "PK", "PN", "PL", "PO", "PY",
    # zachodniopomorskie
    "ZK", "ZS", "ZZ",
}
WYROZNIKI_3_ZNAKOWE = {
    # dolnośląskie
    "DBL", "DDZ", "DGL", "DGR", "DJA", "DJE", "DKA", "DKL", "DLE", "DLB", "DLU", "DLW", "DMI", "DOA", "DOL", "DPL", "DSR", "DST", "DSW", "DTR", "DBA", "DWL", "DWR", "DZA", "DZG", "DZL",
    # kujawsko-pomorskie
    "CAL", "CBR", "CBY", "CCH", "CGD", "CGR", "CIN", "CLI", "CMG", "CNA", "CRA", "CRY", "CSE", "CSW", "CTR", "CTU", "CWA", "CWL", "CZN",
    # lubelskie
    "LBI", "LBL", "LCH", "LHR", "LJA", "LKR", "LKS", "LLB", "LUB", "LLU", "LOP", "LPA", "LPU", "LRA", "LRY", "LSW", "LTM", "LWL", "LZA",
    # lubuskie
    "FGW", "FKR", "FMI", "FNW", "FSL", "FSD", "FSU", "FSW", "FWS", "FZA", "FZG",
    # łódzkie
    "EBE", "EBR", "EKU", "EWE", "ELA", "ELC", "ELE", "ELW", "EOP", "EPA", "EPJ", "EPI", "EPD", "ERA", "ERW", "ESI", "ESK", "ETM", "EWI", "EZD", "EZG",
    # małopolskie
    "KBC", "KBR", "KCH", "KDA", "KGR", "KRA", "KLI", "KMI", "KMY", "KNS", "KNT", "KOL", "KOS", "KPR", "KSU", "KTA", "KTT", "KWA", "KWI",
    # mazowieckie
    "WBR", "WCI", "WGM", "WGR", "WGS", "WKZ", "WL", "WLI", "WLS", "WMA", "WM", "WML", "WND", "WOR", "WOS", "WOT", "WPI", "WPL", "WPN", "WPR", "WPY", "WPZ", "WPU", "WRA", "WSI", "WSE", "WSC", "WSK", "WSZ", "WZ", "WWE", "WWO", "WWL", "WWY", "WZW", "WZU", "WZY",
    # opolskie
    "OBR", "OGL", "OKL", "OKR", "OKS", "ONA", "ONY", "OPO", "OPR", "OST",
    # podkarpackie
    "RBI", "RBR", "RDE", "RJA", "RJS", "RKL", "RKR", "RLS", "RLE", "RLU", "RLA", "RMI", "RNI", "RPR", "RPZ", "RRS", "RZE", "RSA", "RST", "RSR", "RTA",
    # podlaskie
    "BAU", "BIA", "BBI", "BGR", "BHA", "BKL", "BLM", "BMN", "BSE", "BSI", "BSK", "BSU", "BWM", "BZA",
    # pomorskie
    "GBY", "GCH", "GCZ", "GDA", "GKA", "GKS", "GKW", "GLE", "GMB", "GND", "GPU", "GST", "GSZ", "GTC", "GWE",
    # śląskie
    "SBE", "SBI", "SBL", "SCI", "SCZ", "SGL", "SKL", "SLU", "SMI", "SMY", "SPS", "SRC", "SRB", "STA", "SWD", "SZA", "SZY",
    # świętokrzyskie
    "TBU", "TJE", "TKA", "TKI", "TKN", "TOP", "TOS", "TPI", "TSA", "TSK", "TST", "TSZ", "TLW",
    # warmińsko-mazurskie
    "NBA", "NBR", "NDZ", "NEB", "NEL", "NGI", "NGO", "NIL", "NKE", "NLI", "NMR", "NNI", "NNM", "NOE", "NOL", "NOS", "NPI", "NSZ", "NWE",
    # wielkopolskie
    "PCH", "PCT", "PGN", "PGO", "PGS", "PJA", "PKA", "PKE", "PKL", "PKN", "PKO", "PKR", "PLE", "PMI", "PNT", "POB", "POS", "POT", "PPL", "PKS", "PZ", "PRA", "PSL", "PSZ", "PSR", "PSE", "PTU", "PWA", "PWL", "PWR", "PZL",
    # zachodniopomorskie
    "ZBI", "ZCH", "ZDR", "ZGL", "ZGR", "ZGY", "ZKA", "ZKO", "ZMY", "ZPL", "ZPY", "ZST", "ZSD", "ZWA", "ZLO",
}
DOZWOLONE_MARKI = {
    "TOYOTA",
    "NISSAN",
    "BMW",
    "VOLKSWAGEN",
    "MERCEDES",
    "SUZUKI",
}

from rest_framework import serializers
from rest_framework.validators import UniqueValidator
from ..models import Vehicle

class VehicleSerializer(serializers.ModelSerializer):
    registration_number = serializers.CharField(
        allow_blank=False,
        validators=[UniqueValidator(queryset=Vehicle.objects.all())]
    )
    class Meta:
        model = Vehicle
        fields = '__all__'

    def validate_brand(self, value):
        sprawdzana_marka = value.strip().capitalize()

        if sprawdzana_marka not in DOZWOLONE_MARKI:
            raise serializers.ValidationError(
                f"Marka '{value}' nie jest akceptowana. Dozwolone marki to: {', '.join(DOZWOLONE_MARKI)}."
            )
        return value.upper()
    def validate_registration_number(self, value):
        numer_bez_spacji = value.replace(" ", "").upper()
        dlugosc = len(numer_bez_spacji)

        if dlugosc == 7:
            wyroznik = numer_bez_spacji[:2]
            if wyroznik not in WYROZNIKI_2_ZNAKOWE:
                raise serializers.ValidationError(
                    f"Niepoprawny wyróżnik powiatu '{wyroznik}' dla tablicy 7-znakowej."
                )
        elif dlugosc == 8:
            wyroznik = numer_bez_spacji[:3]
            if wyroznik not in WYROZNIKI_3_ZNAKOWE:
                raise serializers.ValidationError(
                    f"Niepoprawny wyróżnik powiatu '{wyroznik}' dla tablicy 8-znakowej."
                )
        else:
            raise serializers.ValidationError(
                "Niepoprawna długość numeru rejestracyjnego. Oczekiwano 7 lub 8 znaków."
            )

        return value.upper()
    



    
    